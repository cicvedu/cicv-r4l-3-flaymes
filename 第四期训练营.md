# 作业1
![./busybox-1.36.1/docs/4th_train_exercise1_step1.png]()

`make LLVM=1 menuconfig` 报错
```shell
scripts/Kconfig.include:40: linker 'ld.lld' not found
```

`make LLVM=1 menuconfig` 配置
![[4th_train_exercise1_step2.png]]

编译结果
![[4th_train_exercise1_step3.png]]


# 作业2
![[4th_train_exercies2_step2.png]]
`make LLVM=1 -j$(nproc)` 编译后进入 执行ifconfig命令
![[4th_train_exercies2_step1.png]]
ifconfig无任何网卡信息

执行相关命令
![[4th_train_exercise2_step3.png]]

能够ping通
![[4th_train_exercise2_result.png]]

![[4th_train_exercise2_result2.png]]

1. r4l_e1000_demo.rs 文件中`module!`宏定义了内核信息，并为`E1000KernelMod`实现了模块的初始化和清理函数。
2. Makefile 文件中，KDIR指定内核源码目录，执行make命令时， -c 命令使得make能够进入内核源码目录，并且make通过`M=$$PWD`指定的目录搜索模块源码。

# 作业3
![[Pasted image 20240721124729.png]]

![[Pasted image 20240721124708.png]]

编译报错
```shell
root@dev:/home/code/cicv-r4l-3-flaymes/linux# make LLVM=1 -j$(nproc)
  SYNC    include/config/auto.conf.cmd
  DESCEND objtool
  CALL    scripts/checksyscalls.sh
  AR      samples/vfio-mdev/built-in.a
  AR      samples/rust/built-in.a
  RUSTC [M] samples/rust/rust_helloworld.o
error: missing documentation for the crate
  --> samples/rust/rust_helloworld.rs:2:1
   |
2  | / use kernel::prelude::*;
3  | |
4  | | module! {
5  | |   type: RustHelloWorld,
...  |
18 | |   }
19 | | }
   | |_^
   |
   = note: `-D missing-docs` implied by `-D warnings`

error: aborting due to previous error
```

解决方法：
文件顶部增加注释
```rust
// SPDX-License-Identifier: GPL-2.0

  
//! Rust helloworld

```

安装模块
![[Pasted image 20240721125340.png]]

# 作业4

# 作业5

参考rust_random.rs实现read和write方法。
从`kernel::io_buffer::IoBufferReader`和 `kernel::io_buffer::IoBufferWriter` 中读写数据到GLOBALMEM_BUF中。
修改 init 方法，指定主设备号为248，与build_image.sh中的 248主设备号对应。
```rust
        let mut chrdev_reg = chrdev::Registration::new_pinned(name, 248, module)?;
        chrdev_reg.as_mut().register::<RustFile>(0)?;
        chrdev_reg.as_mut().register::<RustFile>(1)?;
```

![[4th_train_exercise5_result.png]]
通过mknod命令创建
```shell
echo "mknod /dev/cicv c 248 0" >> etc/init.d/rcS
```
设备号为248；
通过设备号，将驱动模块和设备关联。
